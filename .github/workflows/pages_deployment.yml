name: üöÄ Despliegue de GitHub Pages y Notificaci√≥n a Discord

# 1. Definir los eventos que disparan este workflow
on:
  push:
    branches:
      - main # Dispara el workflow cuando se haga push a la rama 'main'

  # Permite ejecutar este workflow manualmente desde la pesta√±a Actions
  workflow_dispatch:

# 2. Definir los trabajos (jobs)
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    
    # Define los permisos necesarios para el despliegue de Pages
    permissions:
      contents: read
      pages: write
      id-token: write

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      - name: ‚¨áÔ∏è Checkout del C√≥digo
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Configurar P√°ginas de GitHub
        uses: actions/configure-pages@v5

      # Si tu sitio es est√°tico (solo HTML/CSS/JS) no necesitas un paso de build.
      # Si usas Jekyll, Hugo, etc., aqu√≠ ir√≠a tu paso de build.
      # Ejemplo:
      # - name: üèóÔ∏è Compilar Sitio (Si usas un generador est√°tico)
      #   run: npm run build # o tu comando de build

      - name: üì¶ Subir Artefacto
        uses: actions/upload-pages-artifact@v3
        with:
          # Directorio donde est√°n tus archivos de sitio final (ej. `_site`, `public`, o la ra√≠z si es est√°tico)
          path: '.' 

      - name: üöÄ Desplegar a GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: üîî Notificar a Discord sobre el Estado de la Compilaci√≥n
        if: always() 
        uses: rjstone/discord-webhook-notify@v2
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK_URL }}
          
          # Usamos 'title' y 'description' que son inputs v√°lidos y aseguran que el mensaje no est√© vac√≠o
          title: |
            ‚úÖ DESPLIEGUE EXITOSO DE PAGES
          
          description: |
            **Estado:** ${{ job.status }}
            Repositorio: `sMartz1/LWBuilds`
            Rama: `${{ github.ref_name }}`
            
          # El footer es opcional, pero a√±ade informaci√≥n √∫til
          footer: |
            Ver Despliegue: https://smartz1.github.io/LWBuilds/
            Ver Detalles del Job: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            
          # El color basado en el estado (si tiene √©xito, rojo si falla)
          color: ${{ job.status == 'success' && '00FF00' || 'FF0000' }}
          
          username: Notification (Github Actions)
          avatarUrl: https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png